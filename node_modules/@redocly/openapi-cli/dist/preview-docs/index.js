"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = startPreviewServer;

var _handlebars = require("handlebars");

var _chalk = _interopRequireDefault(require("chalk"));

var portfinder = _interopRequireWildcard(require("portfinder"));

var _fs = require("fs");

var path = _interopRequireWildcard(require("path"));

var _server = require("./server");

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// import { watch } from 'chokidar';
function getPageHTML(htmlTemplate, redocOptions = {}, wsPort) {
  let templateSrc = (0, _fs.readFileSync)(htmlTemplate, 'utf-8'); // fix template for backward compatibility

  templateSrc = templateSrc.replace(/{?{{redocHead}}}?/, '{{{redocHead}}}').replace('{{redocBody}}', '{{{redocHTML}}}');
  const template = (0, _handlebars.compile)(templateSrc);
  return template({
    redocHead: `
  <script>
    window.__REDOC_EXPORT = '${redocOptions.licenseKey ? 'RedoclyAPIReference' : 'Redoc'}';
    window.__OPENAPI_CLI_WS_PORT = ${wsPort};
  </script>
  <script src="/simplewebsocket.min.js"></script>
  <script src="/hot.js"></script>
  <script src="${redocOptions.licenseKey ? 'https://cdn.jsdelivr.net/npm/@redocly/api-reference@latest/dist/redocly-api-reference.min.js' : 'https://cdn.jsdelivr.net/npm/redoc@latest/bundles/redoc.standalone.js'}"></script>
`,
    redocHTML: `
  <div id="redoc"></div>
  <script>
    var container = document.getElementById('redoc');
    ${redocOptions.licenseKey ? "window[window.__REDOC_EXPORT].setPublicPath('https://cdn.jsdelivr.net/npm/@redocly/api-reference@latest/dist/');" : ''}
    window[window.__REDOC_EXPORT].init("openapi.json", ${JSON.stringify(redocOptions)}, container)
  </script>`
  });
}

async function startPreviewServer(port, {
  getBundle,
  getOptions
}) {
  const defaultTemplate = path.join(__dirname, 'default.hbs');

  const handler = async (request, response) => {
    console.time(_chalk.default.dim(`GET ${request.url}`));
    const {
      htmlTemplate
    } = getOptions() || {};

    if (request.url === '/') {
      (0, _server.respondWithGzip)(getPageHTML(htmlTemplate || defaultTemplate, getOptions(), wsPort), request, response, {
        'Content-Type': 'text/html'
      });
    } else if (request.url === '/openapi.json') {
      (0, _server.respondWithGzip)(JSON.stringify((await getBundle())), request, response, {
        'Content-Type': 'application/json'
      });
    } else {
      const filePath = {
        '/hot.js': path.join(__dirname, 'hot.js'),
        '/simplewebsocket.min.js': require.resolve('simple-websocket/simplewebsocket.min.js')
      }[request.url] || path.resolve(htmlTemplate ? path.dirname(htmlTemplate) : process.cwd(), `.${request.url}`);
      const extname = String(path.extname(filePath)).toLowerCase();
      const contentType = _server.mimeTypes[extname] || 'application/octet-stream';

      try {
        (0, _server.respondWithGzip)((await _fs.promises.readFile(filePath)), request, response, {
          'Content-Type': contentType
        });
      } catch (e) {
        if (e.code === 'ENOENT') {
          (0, _server.respondWithGzip)('404 Not Found', request, response, {
            'Content-Type': 'text/html'
          }, 404);
        } else {
          (0, _server.respondWithGzip)(`Something went wrong: ${e.code || e.message}...\n`, request, response, {}, 500);
        }
      }
    }

    console.timeEnd(_chalk.default.dim(`GET ${request.url}`));
  };

  let wsPort = await portfinder.getPortPromise({
    port: 32201
  });
  const server = (0, _server.startHttpServer)(port, handler);
  server.on('listening', () => {
    process.stdout.write(`\n  ðŸ”Ž  Preview server running at ${_chalk.default.blue(`http://127.0.0.1:${port}\n`)}`);
  });
  return (0, _server.startWsServer)(wsPort);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9wcmV2aWV3LWRvY3MvaW5kZXguanMiXSwibmFtZXMiOlsiZ2V0UGFnZUhUTUwiLCJodG1sVGVtcGxhdGUiLCJyZWRvY09wdGlvbnMiLCJ3c1BvcnQiLCJ0ZW1wbGF0ZVNyYyIsInJlcGxhY2UiLCJ0ZW1wbGF0ZSIsInJlZG9jSGVhZCIsImxpY2Vuc2VLZXkiLCJyZWRvY0hUTUwiLCJKU09OIiwic3RyaW5naWZ5Iiwic3RhcnRQcmV2aWV3U2VydmVyIiwicG9ydCIsImdldEJ1bmRsZSIsImdldE9wdGlvbnMiLCJkZWZhdWx0VGVtcGxhdGUiLCJwYXRoIiwiam9pbiIsIl9fZGlybmFtZSIsImhhbmRsZXIiLCJyZXF1ZXN0IiwicmVzcG9uc2UiLCJjb25zb2xlIiwidGltZSIsImNoYWxrIiwiZGltIiwidXJsIiwiZmlsZVBhdGgiLCJyZXF1aXJlIiwicmVzb2x2ZSIsImRpcm5hbWUiLCJwcm9jZXNzIiwiY3dkIiwiZXh0bmFtZSIsIlN0cmluZyIsInRvTG93ZXJDYXNlIiwiY29udGVudFR5cGUiLCJtaW1lVHlwZXMiLCJmc1Byb21pc2VzIiwicmVhZEZpbGUiLCJlIiwiY29kZSIsIm1lc3NhZ2UiLCJ0aW1lRW5kIiwicG9ydGZpbmRlciIsImdldFBvcnRQcm9taXNlIiwic2VydmVyIiwib24iLCJzdGRvdXQiLCJ3cml0ZSIsImJsdWUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFDQTs7QUFDQTs7QUFDQTs7QUFHQTs7QUFDQTs7QUFFQTs7Ozs7Ozs7QUFUQTtBQWFBLFNBQVNBLFdBQVQsQ0FBcUJDLFlBQXJCLEVBQW1DQyxZQUFZLEdBQUcsRUFBbEQsRUFBc0RDLE1BQXRELEVBQThEO0FBQzVELE1BQUlDLFdBQVcsR0FBRyxzQkFBYUgsWUFBYixFQUEyQixPQUEzQixDQUFsQixDQUQ0RCxDQUc1RDs7QUFDQUcsRUFBQUEsV0FBVyxHQUFHQSxXQUFXLENBQ3RCQyxPQURXLENBQ0gsbUJBREcsRUFDa0IsaUJBRGxCLEVBRVhBLE9BRlcsQ0FFSCxl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QkFBd0JtQixDQUFDLENBQUNDLElBQUYsSUFBVUQsQ0FBQyxDQUFDRSxPQUFRLE9BQTdELEVBQXFFdEIsT0FBckUsRUFBOEVDLFFBQTlFLEVBQXdGLEVBQXhGLEVBQTRGLEdBQTVGO0FBQ0Q7QUFDRjtBQUNGOztBQUNEQyxJQUFBQSxPQUFPLENBQUNxQixPQUFSLENBQWdCbkIsZUFBTUMsR0FBTixDQUFXLE9BQU1MLE9BQU8sQ0FBQ00sR0FBSSxFQUE3QixDQUFoQjtBQUNELEdBbENEOztBQW9DQSxNQUFJeEIsTUFBTSxHQUFHLE1BQU0wQyxVQUFVLENBQUNDLGNBQVgsQ0FBMEI7QUFBRWpDLElBQUFBLElBQUksRUFBRTtBQUFSLEdBQTFCLENBQW5CO0FBRUEsUUFBTWtDLE1BQU0sR0FBRyw2QkFBZ0JsQyxJQUFoQixFQUFzQk8sT0FBdEIsQ0FBZjtBQUNBMkIsRUFBQUEsTUFBTSxDQUFDQyxFQUFQLENBQVUsV0FBVixFQUF1QixNQUFNO0FBQzNCaEIsSUFBQUEsT0FBTyxDQUFDaUIsTUFBUixDQUFlQyxLQUFmLENBQXNCLHFDQUFvQ3pCLGVBQU0wQixJQUFOLENBQVksb0JBQW1CdEMsSUFBSyxJQUFwQyxDQUF5QyxFQUFuRztBQUNELEdBRkQ7QUFJQSxTQUFPLDJCQUFjVixNQUFkLENBQVA7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbIi8vIGltcG9ydCB7IHdhdGNoIH0gZnJvbSAnY2hva2lkYXInO1xuaW1wb3J0IHsgY29tcGlsZSB9IGZyb20gJ2hhbmRsZWJhcnMnO1xuaW1wb3J0IGNoYWxrIGZyb20gJ2NoYWxrJztcbmltcG9ydCAqIGFzIHBvcnRmaW5kZXIgZnJvbSAncG9ydGZpbmRlcic7XG5cblxuaW1wb3J0IHsgcmVhZEZpbGVTeW5jLCBwcm9taXNlcyBhcyBmc1Byb21pc2VzIH0gZnJvbSAnZnMnO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcblxuaW1wb3J0IHtcbiAgc3RhcnRIdHRwU2VydmVyLCBzdGFydFdzU2VydmVyLCByZXNwb25kV2l0aEd6aXAsIG1pbWVUeXBlcyxcbn0gZnJvbSAnLi9zZXJ2ZXInO1xuXG5mdW5jdGlvbiBnZXRQYWdlSFRNTChodG1sVGVtcGxhdGUsIHJlZG9jT3B0aW9ucyA9IHt9LCB3c1BvcnQpIHtcbiAgbGV0IHRlbXBsYXRlU3JjID0gcmVhZEZpbGVTeW5jKGh0bWxUZW1wbGF0ZSwgJ3V0Zi04Jyk7XG5cbiAgLy8gZml4IHRlbXBsYXRlIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5XG4gIHRlbXBsYXRlU3JjID0gdGVtcGxhdGVTcmNcbiAgICAucmVwbGFjZSgvez97e3JlZG9jSGVhZH19fT8vLCAne3t7cmVkb2NIZWFkfX19JylcbiAgICAucmVwbGFjZSgne3tyZWRvY0JvZHl9fScsICd7e3tyZWRvY0hUTUx9fX0nKTtcblxuICBjb25zdCB0ZW1wbGF0ZSA9IGNvbXBpbGUodGVtcGxhdGVTcmMpO1xuXG4gIHJldHVybiB0ZW1wbGF0ZSh7XG4gICAgcmVkb2NIZWFkOiBgXG4gIDxzY3JpcHQ+XG4gICAgd2luZG93Ll9fUkVET0NfRVhQT1JUID0gJyR7cmVkb2NPcHRpb25zLmxpY2Vuc2VLZXkgPyAnUmVkb2NseUFQSVJlZmVyZW5jZScgOiAnUmVkb2MnfSc7XG4gICAgd2luZG93Ll9fT1BFTkFQSV9DTElfV1NfUE9SVCA9ICR7d3NQb3J0fTtcbiAgPC9zY3JpcHQ+XG4gIDxzY3JpcHQgc3JjPVwiL3NpbXBsZXdlYnNvY2tldC5taW4uanNcIj48L3NjcmlwdD5cbiAgPHNjcmlwdCBzcmM9XCIvaG90LmpzXCI+PC9zY3JpcHQ+XG4gIDxzY3JpcHQgc3JjPVwiJHtyZWRvY09wdGlvbnMubGljZW5zZUtleVxuICAgID8gJ2h0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vQHJlZG9jbHkvYXBpLXJlZmVyZW5jZUBsYXRlc3QvZGlzdC9yZWRvY2x5LWFwaS1yZWZlcmVuY2UubWluLmpzJ1xuICAgIDogJ2h0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vcmVkb2NAbGF0ZXN0L2J1bmRsZXMvcmVkb2Muc3RhbmRhbG9uZS5qcyd9XCI+PC9zY3JpcHQ+XG5gLFxuICAgIHJlZG9jSFRNTDogYFxuICA8ZGl2IGlkPVwicmVkb2NcIj48L2Rpdj5cbiAgPHNjcmlwdD5cbiAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlZG9jJyk7XG4gICAgJHtyZWRvY09wdGlvbnMubGljZW5zZUtleSA/IFwid2luZG93W3dpbmRvdy5fX1JFRE9DX0VYUE9SVF0uc2V0UHVibGljUGF0aCgnaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9AcmVkb2NseS9hcGktcmVmZXJlbmNlQGxhdGVzdC9kaXN0LycpO1wiIDogJyd9XG4gICAgd2luZG93W3dpbmRvdy5fX1JFRE9DX0VYUE9SVF0uaW5pdChcIm9wZW5hcGkuanNvblwiLCAke0pTT04uc3RyaW5naWZ5KHJlZG9jT3B0aW9ucyl9LCBjb250YWluZXIpXG4gIDwvc2NyaXB0PmAsXG4gIH0pO1xufVxuXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBzdGFydFByZXZpZXdTZXJ2ZXIocG9ydCwge1xuICBnZXRCdW5kbGUsXG4gIGdldE9wdGlvbnMsXG59KSB7XG4gIGNvbnN0IGRlZmF1bHRUZW1wbGF0ZSA9IHBhdGguam9pbihfX2Rpcm5hbWUsICdkZWZhdWx0LmhicycpO1xuICBjb25zdCBoYW5kbGVyID0gYXN5bmMgKHJlcXVlc3QsIHJlc3BvbnNlKSA9PiB7XG4gICAgY29uc29sZS50aW1lKGNoYWxrLmRpbShgR0VUICR7cmVxdWVzdC51cmx9YCkpO1xuICAgIGNvbnN0IHsgaHRtbFRlbXBsYXRlIH0gPSBnZXRPcHRpb25zKCkgfHwge307XG5cbiAgICBpZiAocmVxdWVzdC51cmwgPT09ICcvJykge1xuICAgICAgcmVzcG9uZFdpdGhHemlwKGdldFBhZ2VIVE1MKGh0bWxUZW1wbGF0ZSB8fCBkZWZhdWx0VGVtcGxhdGUsIGdldE9wdGlvbnMoKSwgd3NQb3J0KSwgcmVxdWVzdCwgcmVzcG9uc2UsIHtcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICd0ZXh0L2h0bWwnLFxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChyZXF1ZXN0LnVybCA9PT0gJy9vcGVuYXBpLmpzb24nKSB7XG4gICAgICByZXNwb25kV2l0aEd6aXAoSlNPTi5zdHJpbmdpZnkoYXdhaXQgZ2V0QnVuZGxlKCkpLCByZXF1ZXN0LCByZXNwb25zZSwge1xuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGZpbGVQYXRoID0ge1xuICAgICAgICAnL2hvdC5qcyc6IHBhdGguam9pbihfX2Rpcm5hbWUsICdob3QuanMnKSxcbiAgICAgICAgJy9zaW1wbGV3ZWJzb2NrZXQubWluLmpzJzogcmVxdWlyZS5yZXNvbHZlKCdzaW1wbGUtd2Vic29ja2V0L3NpbXBsZXdlYnNvY2tldC5taW4uanMnKSxcbiAgICAgIH1bcmVxdWVzdC51cmxdIHx8IHBhdGgucmVzb2x2ZShodG1sVGVtcGxhdGUgPyBwYXRoLmRpcm5hbWUoaHRtbFRlbXBsYXRlKSA6IHByb2Nlc3MuY3dkKCksIGAuJHtyZXF1ZXN0LnVybH1gKTtcblxuICAgICAgY29uc3QgZXh0bmFtZSA9IFN0cmluZyhwYXRoLmV4dG5hbWUoZmlsZVBhdGgpKS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgICBjb25zdCBjb250ZW50VHlwZSA9IG1pbWVUeXBlc1tleHRuYW1lXSB8fCAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJztcbiAgICAgIHRyeSB7XG4gICAgICAgIHJlc3BvbmRXaXRoR3ppcChhd2FpdCBmc1Byb21pc2VzLnJlYWRGaWxlKGZpbGVQYXRoKSwgcmVxdWVzdCwgcmVzcG9uc2UsIHtcbiAgICAgICAgICAnQ29udGVudC1UeXBlJzogY29udGVudFR5cGUsXG4gICAgICAgIH0pO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBpZiAoZS5jb2RlID09PSAnRU5PRU5UJykge1xuICAgICAgICAgIHJlc3BvbmRXaXRoR3ppcCgnNDA0IE5vdCBGb3VuZCcsIHJlcXVlc3QsIHJlc3BvbnNlLCB7ICdDb250ZW50LVR5cGUnOiAndGV4dC9odG1sJyB9LCA0MDQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlc3BvbmRXaXRoR3ppcChgU29tZXRoaW5nIHdlbnQgd3Jvbmc6ICR7ZS5jb2RlIHx8IGUubWVzc2FnZX0uLi5cXG5gLCByZXF1ZXN0LCByZXNwb25zZSwge30sIDUwMCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgY29uc29sZS50aW1lRW5kKGNoYWxrLmRpbShgR0VUICR7cmVxdWVzdC51cmx9YCkpO1xuICB9O1xuXG4gIGxldCB3c1BvcnQgPSBhd2FpdCBwb3J0ZmluZGVyLmdldFBvcnRQcm9taXNlKHsgcG9ydDogMzIyMDEgfSk7XG5cbiAgY29uc3Qgc2VydmVyID0gc3RhcnRIdHRwU2VydmVyKHBvcnQsIGhhbmRsZXIpO1xuICBzZXJ2ZXIub24oJ2xpc3RlbmluZycsICgpID0+IHtcbiAgICBwcm9jZXNzLnN0ZG91dC53cml0ZShgXFxuICDwn5SOICBQcmV2aWV3IHNlcnZlciBydW5uaW5nIGF0ICR7Y2hhbGsuYmx1ZShgaHR0cDovLzEyNy4wLjAuMToke3BvcnR9XFxuYCl9YCk7XG4gIH0pO1xuXG4gIHJldHVybiBzdGFydFdzU2VydmVyKHdzUG9ydCk7XG59XG4iXX0=